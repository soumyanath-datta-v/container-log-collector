# Kubernetes Log Collector

## Overview
The Kubernetes Log Collector is a PowerShell-based tool designed to automate the collection of logs from specific Kubernetes pods in the `prod` namespace. It filters pods based on configuration, retrieves their logs periodically, and provides mechanisms for log rotation and consolidation.

## Project Structure
```
kubernetes-log-collector
├── scripts
│   ├── log-collector.ps1
│   └── helpers
│       ├── kubectl-helpers.ps1
│       └── output-formatting.ps1
├── config
│   └── settings.json
├── logs
│   └── .gitkeep
├── pod-logs
├── app-state-prod.log
├── README.md
└── run.ps1
```

## Files Description

- **scripts/log-collector.ps1**: 
  The main script that collects logs from Kubernetes pods matching specified filters. It runs on a configurable interval (default 60 minutes), stores individual pod logs in the `pod-logs` directory, and can combine them into a single log file.

- **scripts/helpers/kubectl-helpers.ps1**: 
  Helper functions for executing kubectl commands and handling their output. Includes functions to get pod lists, filter pods, and retrieve logs.

- **scripts/helpers/output-formatting.ps1**: 
  Functions for formatting log entries and timestamps to ensure consistent output across the application.

- **config/settings.json**: 
  Configuration settings including log file paths, kubectl namespace, pod filters, and collection intervals.

- **logs/.gitkeep**: 
  Placeholder to ensure the logs directory is tracked by version control.

- **pod-logs/**: 
  Directory containing individual log files for each monitored pod.

- **app-state-prod.log**: 
  The main combined log file generated by merging individual pod logs.

- **README.md**: 
  Documentation for the project with setup and usage instructions.

- **run.ps1**: 
  Entry point script that executes the log collector.

## Features

- **Periodic Log Collection**: Automatically collects logs every 60 minutes (configurable)
- **Pod Filtering**: Includes or excludes pods based on name patterns
- **Individual & Combined Logs**: Maintains separate logs for each pod and a combined log
- **Log Rotation**: Automatically splits large log files (>100MB) into manageable chunks
- **Graceful Termination**: Handles Ctrl+C to properly finalize log collection before exit

## Usage
1. Ensure you have the necessary permissions to execute kubectl commands in your Kubernetes cluster.
2. Modify the `config/settings.json` file if needed to adjust:
   - Log file paths
   - Kubernetes namespace
   - Pod filters
   - Collection interval
3. Run the `run.ps1` script to start the log collection process:
   ```powershell
   .\run.ps1
   ```

## Requirements
- PowerShell
- kubectl installed and configured to access your Kubernetes cluster
